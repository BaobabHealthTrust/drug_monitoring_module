<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">


    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Highcharts Example</title>

    <!--script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script-->
    <%=javascript_include_tag "Charts/Highcharts/jquery.min"%>

    <script type="text/javascript">

    function plotGraph(drug) {
      results = document.getElementById('results').value;
      results = JSON.parse(results)

    $(function () {
        $('#container-chart').highcharts({
            chart: {
                type: 'spline'
            },
            title: {
                text: 'Stock Movement Report For ' +drug
            },
            subtitle: {
                text: ''
            },
            xAxis: {

                type: 'datetime',
                dateTimeLabelFormats: {
                    day: '%e %b %y',
                    week: '%e %b %y'
                },
                minTickInterval: 24 * 3600 * 1000
            },
            yAxis: {

                title: {
                    text: 'Tins in stock'
                },
                labels: {
                    formatter: function() {
                        return this.value;
                    }
                }

            },
            tooltip: {
                shared: true,
                headerFormat: '<b>{point.y} Tins of {series.name}</b><br>',
                pointFormat: 'on {point.x:%e. %b %Y}',
                valueSuffix: ' Tins'
            },
            plotOptions: {
                area: {
                    stacking: 'normal',
                    lineColor: '#666666',
                    lineWidth: 2,
                    marker: {
                        lineWidth: 100,
                        lineColor: '#000000'
                    }
                }
            },
            series: [{
            name: drug,
            data: dataG(),
            negativeColor: 'red'
        }],
            exporting: { enabled: false },
            credits: { enabled: false }
        });
    });
    

  }

    function dataG() {
        results = document.getElementById('results').value;
        results = JSON.parse(results);
        
        data = []
        
        for (i = 0; i < results.length; i++){
            date = new Date(results[i][0])
		
            data.push([Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()) ,results[i][1]])
        }

        return data.sort(function(a, b) {
            return a[0] > b[0]?1:-1;
        });
    }
    function sort_results(myCoordinates)
    {
        myCoordinates.sort(function(a, b) {
            return a[1] > b[1]?1:-1;
        });
    }
    </script>


  </head>
  <body>

    <%=javascript_include_tag "Charts/Highcharts/highcharts"%>
    <%=javascript_include_tag "Charts/Highcharts/exporting"%>
    <div id="wait" >
    </div>
    <div id="container-chart" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
    <input type="hidden" id="results" />
  </body>
</html>
