<link rel="stylesheet" type="text/css" href="/stylesheets/demo_table.css" />
<script type="text/javascript" language="javascript" src="/javascripts/jquery.js"></script>
<script type="text/javascript" language="javascript" src="/javascripts/jquery.dataTables.js"></script>
<script>
  /* $(document).ready(function() {
    $('#datalist').dataTable({
      "bPaginate": false,
      "bLengthChange": false,
      "bFilter": true,
      "bSort": false,
      "bInfo": false,
      "bAutoWidth": false
    });
} );
   */
  $(document).ready(function() {
    $('#datalist').dataTable({
      "aaSorting": [[ 0, "asc" ]],
      'iDisplayLength': 10,
      "bLengthChange": false,
      "bRetrieve": true,
      "bFilter": false,
      "oSearch ":false
    });
  } );

</script>

<style type="text/css">
  input{
    width: auto;
    font-size: 28px;
  }
  select{
    width: 100%;
    font-size: 28px;
  }
  button{
    width: auto;
    font-size: 28px;
  }
  table.fullpage{
    margin-left: auto;
    margin-right: auto;
    margin-top: -1%;
    width: 100%;
    margin-bottom: 20px;
  }
  .halfpage tr{
    height: 80px;

  }

  .link{
    float: right;
    position: absolute;
    z-index: 100;
    right: 1%;
    top: 4px;
  }

  th{
    text-align: left;
    font-size: 16px;
    background: #66CC66;
    padding: 10px;
    border-radius: 2px;
    color: black;
  }
  #datalist td{
    text-align: left;
    font-size: 16px;
    color: darkslategrey;
    background-color: azure;
  }
  #datalist{

  }
  .header {
    position: absolute;
    top: 3%;
    width: 100%;
    z-index: 0;
    height: 10%;
    overflow: hidden;
  }

  #datalist_filter{
    margin-top: -3%;
  }
  div.dataTables_filter, div.dataTables_length{
    display: none ;
  }
</style>

<div class="stock-data">

  <table  class="fullpage header" width="100" cellspacing="5px" cellpadding="10px">

    <tr>

      <td style=" width: 100%; padding-left: 10%; font-size: 20px;"><span style="color: lightblue;font-weight: bold;">Select date :</span>

        <select id="sites" style="margin-left: 3%; width:  20%; font-size: 20px;" name="site_name"
                onchange="loadSite(this.value)">
                  <% (@stocks.keys || []).each do |site| %>
            <option value="<%= site %>"><%= site.to_date.strftime("%d %b, %Y") %></option>
          <% end %>
        </select> <span style="color: lightblue; font-size: 18px; font-weight: bold;">Site: <%= @site %></span>
      </td>
      <td id ="date" style="display: none; color: lightblue; font-size: 18px; font-weight: bold;"></td>
    </tr>

  </table>
  <div style="width: 100%;text-align: center;">
    <table id ="datalist"  style="margin-top: 0%; width: 100%"  cellspacing="4px" cellpadding="10px">
      <thead width="100"  style="width: 100%;">
        <tr  style="background-color:#66CC66">
          <th style="width: 55%">Drug name</th>
          <th style="width: 20%">Total delivered</sub></th>
          <th style="width: 20%">Delivery code</th>
        </tr>
      </thead>
      <tbody id="body">

      </tbody>
    </table>
  </div>
</div>

<script type="text/javascript">
  <!--
  var stocks = {};
  var site = "<%=  @stocks.keys.first%>"
<%@stocks.keys.each do |key|%>

    stocks["<%= key %>"] = {};
  <%@stocks[key].keys.each do |drug|%>

      stocks["<%= key %>"]["<%= drug %>"] = {};
    <% @stocks[key][drug].each do |k, v| %>
        stocks["<%= key %>"]["<%= drug %>"]["<%= k %>"] = "<%= v%>";
    <%end%>
  <%end%>
<%end%>

  function loadSite(sit)
  {

    site = sit;
    if(Object.keys(stocks).length == 0){
      jQuery('#data-holder').empty().html("<span style='padding-left: 20.5%; margin-top: 40%; vertical-align: middle; width: 100%; text-align: center; font-size: 30px;'> \n\
    No delivery details found for specified time range </span>")
    }else{
      var data = stocks[sit];
      var drugs = Object.keys(data);
      var table = document.getElementById("body");
      var dateLabel = document.getElementById("date");
      jQuery("#datalist").dataTable().fnClearTable();
      
      for (var i = 0; i < drugs.length; i++){

        var v = 0
        if (cat == 'tins'){
          try{v = parseInt(parseInt(data[drugs[i]]["value"])/60)}catch(x){ v = 0}
        }else{
          try{v = parseInt(parseInt(data[drugs[i]]["value"]))}catch(x){ v = 0}
        }

        jQuery("#datalist").dataTable().fnAddData([

          (drugs[i].toString()),
          ("<span class='drug_value' pills=" + v + ">" + v.toString() + "</span>"),
          (data[drugs[i]]["code"].toString())

        ]);

      }
    }
  }
  
  loadSite(site);

  //-->
</script>
